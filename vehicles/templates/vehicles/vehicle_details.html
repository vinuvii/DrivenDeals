{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block extra_head %}
<style>
    html, body {
        overflow-x: hidden;
    }
    .vehicle-header {
        width: 100%;
        height: 300px; /* Adjust height as needed */
        overflow: hidden;
        position: relative;
        margin-top: -150px;
    }

    .vehicle-header img {
        width: 100%;
        height: 100%; /* Ensure the image fills its container */
        object-fit: cover; /* Ensures the image covers the entire container */
        position: absolute; /* Position image absolutely within its container */
        top: 0;
        left: 0;
    }

    .vehicle-overlay {
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif;
        position: absolute;
        top: 180px;
        left: 180px;
        color: white;
        padding: 5px 10px;
        font-size: 36px;
        font-weight: bold;
        z-index: 10; /* Ensure overlay is above the image */
    }

    .vehicle-details-section {
        background-color: #f9f9f9;
        padding: 60px 60px;
    }

    .vehicle-details-section__head-title {
        position: relative;
        font-size: 45px;
        font-weight: bold;
        text-transform: uppercase;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif;
    }

    .vehicle-details-section__head-title::before {
        content: '';
        position: absolute;
        top: 0;
        left: -20px; /* Adjust this value to control the distance from the text */
        width: 5px; /* Adjust this value to control the thickness of the line */
        height: 100%;
        background-color: #de483d; /* Red color */
    }

    .vehicle-details-section__head h1,
    .vehicle-details-section__head h3 {
        margin: 10px 0;
        padding-left: 10px; /* Add padding to separate text from line */
    }

    .vehicle-details-section__head-price {
        text-align: right;
        margin-top: 20px; /* Adjust spacing */
    }

    .vehicle-details-section__head-price-num {
        font-size: 30px;
        font-weight: bold;
        color: #ffffff;
        background-color: #de483d; /* Background color */
        display: inline-block;
        padding: 10px 25px;
        border-radius: 2px;
    }

    .vehicle-details-section__head-price p {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
    }
    #vehicle-details-container {
        background-color: #f9f9f9;
        padding: 20px;
    }
    #vehicle-details-container .vehicle-card {
        background-color: #ffffff;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Adjusted shadow */
        border: 1px solid rgba(0, 0, 0, 0.1); /* Darker border */
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
        padding: 20px; /* Added padding */
        max-width: 800px; /* Adjusted max-width to control size */
        max-height: 805px; /* Adjusted max-height */
        margin: 0 auto; /* Center the vehicle-card */
        position: relative;
    }


    #vehicle-details-container .vehicle-gallery {
        width: 100%;
        height: auto;
        position: relative;
        overflow: hidden;
    }

    #vehicle-details-container .vehicle-gallery img {
        width: 100%;
        height: auto;
        object-fit: cover;
        border-radius: 5px;
        cursor: pointer;
        max-width: 760px; /* Adjusted max-width to control size */
        min-width: 760px;
        max-height: 570px;
        min-height: 570px;
    }

    #vehicle-details-container .thumbnail-images {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 10px;
        margin-top: 25px;
    }

    #vehicle-details-container .thumbnail-images img {
        width: 180px; /* Thumbnail width */
        height: 150px; /* Thumbnail height */
        object-fit: cover;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
    }

    #vehicle-details-container .thumbnail-images img:hover {
        opacity: 0.7; /* Reduce opacity on hover */
    }

    #vehicle-details-container .vehicle-description-card  {
        padding-top: 0; /* Adjust padding-top if needed */
        padding-bottom: 0; /* Adjust padding-bottom if needed */
        margin-top: 0px; /* Adjust margin-top if needed */
        margin-bottom: 20px; /* Example: Set margin-bottom to create space between sections */
        width: 550px; /* Adjust the width as needed */
        margin-right: 20px;
        background-color: #de483d;
        border-radius: 8px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }


    #vehicle-details-container .vehicle-description-card .card-header {
        background-color: #de483d;
        padding-top: 20px;
        border-width: 8px 8px 0 8px; /* top, right, bottom, left */
        border-color: #ffffff;
    }


    #vehicle-details-container .vehicle-description-card .card-title  {
        color: #ffffff;
        font-size: 1.25rem;
        font-weight: bold;
    }

    #vehicle-details-container .vehicle-description-card .card-body {
        padding: 0;
    }

    #vehicle-details-container .vehicle-description-card .table {
        background-color: #de483d;
        margin-bottom: 0;
        border: 1px solid #f0b1af;
        border: 8px solid #ffffff;
        border-radius: 8px;
    }

    .vehicle-description-card .table tbody tr:nth-child(even) {
        background-color: #f7c6c5; /* Lighter shade of #de483d */
    }

    .vehicle-description-card .table tbody tr:nth-child(odd) {
        background-color: #f0b1af; /* Slightly lighter shade of #de483d */
    }
    .seller-details {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }


    .modal-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1;
        border-radius: 20px;
    }

    .modal-dialog {
        max-width: 800px;
        border-radius: 20px;
        background: url('https://images.frandroid.com/wp-content/uploads/2016/02/google_car.jpg') no-repeat center center;
        background-size: cover;
        position: relative;
    }

    .modal-content {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        padding: 20px;
        position: relative;
        z-index: 2;
    }

    .modal-header {
        border-bottom: none;
    }

    .modal-body {
        text-align: center;
    }

    .modal-header .close {
        color: #fff; /* Close button color */
    }

    .modal-body p {
        color: #000; /* Ensure modal body text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .max-bid-section {
        text-align: left;
        margin: 20px 0;
    }

    .max-bid-label {
        font-size: 16px;
        text-align: left;
        margin-bottom: 10px;
        color: #000; /* Change text color to black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .max-bid-input {
        display: flex;
        align-items: center;
        border-radius: 10px;
        overflow: hidden;
    }

    .max-bid-currency {
        font-weight: bold;
        margin-right: 5px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .terms {
        font-size: 12px;
        color: #888;
        margin: 0;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .reserve-status {
        font-size: 16px;
        font-weight: bold;
        text-align: left;
        color: #000; /* Ensure reserve status text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bids-total {
        font-size: 16px;
        font-weight: bold;
        text-align: right;
        color: #000; /* Ensure bids total text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .time-remaining {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
        font-size: 24px;
        font-weight: bold;
    }

    .time-remaining span {
        margin: 0 5px;
    }

    .time-labels {
        display: flex;
        justify-content: center;
        font-size: 12px;
        color: #888;
    }

    .time-labels span {
        margin: 0 5px;
    }

    .bid-values {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }
    .bid-value {
        background-color: #ADCCE9;
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 10px;
        transition: background-color 0.3s ease;
        width: 145px;
        height: 42px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bid-value:hover {
        background-color: #77AAD9;
    }

    .form-control {
        margin: 0;
        border-radius: 0;
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
    }

    .max-bid-section {
        text-align: left;
        margin: 20px 0;
    }

    .max-bid-label {
        font-size: 16px;
        text-align: left;
        margin-bottom: 10px;
        color: #000; /* Change text color to black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .max-bid-input {
        display: flex;
        align-items: center;
        border-radius: 10px;
        overflow: hidden;
    }

    .max-bid-currency {
        font-weight: bold;
        margin-right: 5px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .terms {
        font-size: 12px;
        color: #888;
        margin: 0;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .reserve-status {
        font-size: 16px;
        font-weight: bold;
        text-align: left;
        color: #000; /* Ensure reserve status text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bids-total {
        font-size: 16px;
        font-weight: bold;
        text-align: right;
        color: #000; /* Ensure bids total text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .time-remaining {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
        font-size: 24px;
        font-weight: bold;
    }

    .time-remaining span {
        margin: 0 5px;
    }

    .time-labels {
        display: flex;
        justify-content: center;
        font-size: 12px;
        color: #888;
    }

    .time-labels span {
        margin: 0 5px;
    }

    .bid-values {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }

    .bid-value {
        background-color: #ADCCE9;
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 10px;
        transition: background-color 0.3s ease;
        width: 145px;
        height: 42px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bid-value:hover {
        background-color: #77AAD9;
    }

    .form-control {
        margin: 0;
        border-radius: 0;
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
    }

    .max-bid-section {
        text-align: left;
        margin: 20px 0;
    }

    .max-bid-label {
        font-size: 16px;
        text-align: left;
        margin-bottom: 10px;
        color: #000; /* Change text color to black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .max-bid-input {
        display: flex;
        align-items: center;
        border-radius: 10px;
        overflow: hidden;
    }

    .max-bid-currency {
        font-weight: bold;
        margin-right: 5px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .terms {
        font-size: 12px;
        color: #888;
        margin: 0;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .reserve-status {
        font-size: 16px;
        font-weight: bold;
        text-align: left;
        color: #000; /* Ensure reserve status text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bids-total {
        font-size: 16px;
        font-weight: bold;
        text-align: right;
        color: #000; /* Ensure bids total text color is black */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .time-remaining {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
        font-size: 12px;
        font-weight: bold;
    }
    .time-unit {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0 5px;
    }

    .time-value {
        font-size: 2em;
        font-weight: bold;
    }

    .time-separator {
        font-size: 2em;
        font-weight: bold;
        margin: 0 5px;
    }

    .time-remaining span {
        margin: 0 5px;
    }

    .time-labels {
        display: flex;
        justify-content: center;
        font-size: 12px;
        color: #888;
    }

    .time-labels span {
        margin: 0 5px;
    }

    .time-remaining p {
        margin-bottom: 10px;
        font-weight: bold;
    }

    .bid-values {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }

    .bid-value {
        background-color: #ADCCE9;
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 10px;
        transition: background-color 0.3s ease;
        width: 145px;
        height: 42px;
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .bid-value:hover {
        background-color: #77AAD9;
    }

    .form-control {
        margin: 0;
        border-radius: 0;
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
    }
    .btn-primary {
        background-color: #de483df; /* Primary color */
        border-color: #de483d; /* Primary border color */
        color: #fff;
    }

    .btn-primary:hover {
        background-color: #b23a31; /* Darker shade on hover */
        border-color: #b23a31; /* Darker border color on hover */
    }

    /* Outline secondary button styles */
    .btn-outline-secondary {
        background-color: transparent; /* Transparent background */
        border-color: #6c757d; /* Secondary border color */
        color: #6c757d; /* Secondary text color */
    }

    .btn-outline-secondary:hover {
        background-color: #6c757d; /* Background color on hover */
        color: #fff; /* Text color on hover */
    }

    /* Disabled button styles */
    .btn-outline-secondary:disabled {
        background-color: #e0e0e0; /* Disabled background color */
        border-color: #ccc; /* Disabled border color */
        color: #888; /* Disabled text color */
    }

    .btn-custom {
        margin-bottom: 20px;
        border-radius: 10px; /* Soft edges */
        transition: background-color 0.3s ease;
        width: 100%; /* Full width */
        display: block;
        height: 42px; /* Same height for consistency */
        font-family: 'Open Sans', 'Titillium Web', 'PT Sans', Arial, sans-serif; /* Apply desired font */
    }

    .btn-custom.btn-success {
        background-color: #28a745;
        border-color: #28a745;
        color: #fff;
    }

  .seller-description-card {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    background-color: #f0f0f0;
    border: 8px solid #ffffff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .seller-description-card .card-header {
    background-color: #f0f0f0;
    padding: 10px 20px;
    margin: -8px;
  }

  .seller-description-card .card-title {
    font-size: 1.25rem;
    font-weight: bold;
  }

  .seller-description-card .card-body {
    padding: 20px 20px; /* Added padding to the card body */
  }

  .seller-description-card p {
    margin-bottom: 5px; /* Increased margin-bottom for better spacing */
    margin-left: 10px;
    padding: 3px;
    margin-top: 10px;

  }

  .seller-description-card p:last-child {
    margin-bottom: 0;
  }

  .seller-description-card a {
    color: #007bff; /* Blue color */
    text-decoration: underline;
  }

  .seller-description-card a:hover {
    text-decoration: none;
  }

    .vehicle-features {
        margin-top: 20px;
        margin-left: 20px;
    }


    .vehicle-features ul {
        list-style-type: none;
        padding-left: 0;
    }

    .vehicle-features li {
        margin-bottom: 12px;
        line-height: 1.8;
    }

    .vehicle-features .fa-check-circle {
        margin-right: 10px;
        color: #de483d;
        font-size: 16px;
    }
    .vehicle-features h3 {
        font-size: 1.75rem; /* Increase font size */
        font-weight: bold; /* Make the text bold */
        margin-bottom: 20px; /* Adds space below the heading */
        color: #333; /* Sets a dark color for the heading text */
        margin-top: 20px;
    }

    .vehicle-description {
        margin-top: 20px; /* Adds space above the description section */
    }

    .vehicle-description .description-text p {
        text-align: justify; /* Justify the text */
        font-size: 16px; /* Example font size */
        line-height: 1.6; /* Example line height */
    }

    .vehicle-description .description-text {
        margin-top: 10px; /* Example margin top */
        margin-bottom: 20px;
        text-align: justify;
    }

    .description-text p {
        text-align: justify;
        margin-left: 20px;
        margin-right: 60px;
    }

    #placeBidButton {
    background-color: #de483d; /* Primary button background color */
    border: #de483d;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 5px;
}

#placeBidButton:hover {
    background-color:  #e68883; /* Darker shade for hover */
    border: none;
    color: white;
}

#watchlistButton {
    background-color: #f0f0f0; /* Outline secondary button background color */
    border: 1px solid #6c757d; /* Outline border color */
    color: #6c757d; /* Outline secondary button text color */
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 5px;
}

#watchlistButton:hover {
    background-color: #e5e5ea; /* Slightly darker background for hover */
    border: 1px solid #5a6268; /* Darker outline for hover */
    color: #5a6268; /* Darker text color for hover */
}

#watchlistButton .fa-check {
    color: green;
}

#watchlistButton .fa-star {
    color: gold;
}

.btn-custom {
    /* Additional custom styles for all buttons with btn-custom class */
    font-weight: bold;
}

.btn-custom:disabled {
    background-color: #f4c7c3; /* Disabled button background color */
    color: #6c757d; /* Disabled button text color */
    cursor: not-allowed;
}


</style>
{% endblock %}

{% block content %}
<div class="vehicle-details">
    <div class="vehicle-header">
        <img src="https://www.freewebheaders.com/wp-content/gallery/cars/cache/toyota-gt86-dashboard-car-website-header.jpg-nggid043742-ngg0dyn-1280x375x100-00f0w010c010r110f110r010t010.jpg" alt="Vehicle Details Page">
             <div class="vehicle-overlay">Vehicle Details Page</div>
    </div>
</div>

<section class="vehicle-details-section">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <div class="vehicle-details-section__head">
                    <div class="vehicle-details-section__head-title">
                        <h1>{{ vehicle.make }} - {{ vehicle.model }}</h1>
                        <h3>{{ vehicle.year }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="vehicle-details-section__head-price">
                    <div class="vehicle-details-section__head-price-num">LKR {{ highest_bid|intcomma }}</div>
                    <p>Winning Bid Price</p>
                </div>
                <button class="btn btn-outline-secondary btn-custom" id="watchlistButton"
                    data-vehicle-id="{{ vehicle.id }}">
                    {% if is_in_watchlist %}
                        <i class="fas fa-check"></i> Added to Watchlist
                    {% else %}
                        <i class="far fa-star"></i> Add to Watchlist
                    {% endif %}
                </button>

                {% if auction_ended %}
                    <button class="btn btn-outline-secondary btn-custom" id="auctionEndedButton" disabled>Auction Ended</button>
                {% else %}
                    <button class="btn btn-primary btn-custom" id="placeBidButton">Place Bid</button>
                {% endif %}

            </div>
        </div>
    </div>
</section>


<div id="vehicle-details-container" class="container">
  <div class="row">
    <div class="col-md-7">
        <div class="vehicle-card">
          <div class="vehicle-gallery">
              <img id="main-image" src="{{ vehicle.picture.url }}" class="img-fluid" alt="{{ vehicle.model }}">
          </div>
          <div class="thumbnail-images">
            <img src="{{ vehicle.picture.url }}" alt="{{ vehicle.model }}" onclick="displayImage('{{ vehicle.picture.url }}')">
                        {% if vehicle.picture2 %}
                            <img src="{{ vehicle.picture2.url }}" alt="Additional Image 1" onclick="displayImage('{{ vehicle.picture2.url }}')">
                        {% endif %}
                        {% if vehicle.picture3 %}
                            <img src="{{ vehicle.picture3.url }}" alt="Additional Image 2" onclick="displayImage('{{ vehicle.picture3.url }}')">
                        {% endif %}
                        {% for image in vehicle.additional_images.all %}
                            <img src="{{ image.url }}" alt="{{ vehicle.model }}" onclick="displayImage('{{ image.url }}')">
                        {% endfor %}
          </div>
        </div>
    </div>

    <div class="col-md-5">
      <div class="vehicle-description-card">
          <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Description</h5>
                </div>
              <div class="card-body">
                <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <th>Manufacturer</th>
                                        <td>{{ vehicle.make }}</td>
                                    </tr>
                                    <tr>
                                        <th>Model</th>
                                        <td>{{ vehicle.model }}</td>
                                    </tr>
                                    <tr>
                                        <th>Year</th>
                                        <td>{{ vehicle.year }}</td>
                                    </tr>
                                    <tr>
                                        <th>Color</th>
                                        <td>{{ vehicle.color }}</td>
                                    </tr>
                                    <tr>
                                        <th>Mileage</th>
                                        <td>{{ vehicle.mileage }} km</td>
                                    </tr>
                                    <tr>
                                        <th>Fuel Type</th>
                                        <td>{{ vehicle.fuel_type | capfirst}}</td>
                                    </tr>
                                    <tr>
                                        <th>Body Type</th>
                                        <td>{{ vehicle.body_type | capfirst}}</td>
                                    </tr>
                                    <tr>
                                        <th>Engine Capacity</th>
                                        <td>{{ vehicle.engine_capacity }}</td>
                                    </tr>
                                    <tr>
                                        <th>Engine Type</th>
                                        <td>{{ vehicle.engine_type | capfirst}}</td>
                                    </tr>
                                    <tr>
                                        <th>Transmission Type</th>
                                        <td>{{ vehicle.transmission_type | capfirst}}</td>
                                    </tr>
                                    <tr>
                                        <th>Number of Seats</th>
                                        <td>{{ vehicle.no_of_seats }}</td>
                                    </tr>
                                </tbody>
                </table>
              </div>
          </div>
      </div>

        <div class="vehicle-description-card">
          <div class="seller-description-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Seller Details</h5>
                </div>
                    <p><strong>Name: </strong>{{ vehicle.seller.first_name }} {{ vehicle.seller.last_name }}</p>
                    <p><strong>Trading Address: </strong>{{ vehicle.seller.trading_address }}</p>
                    <p><strong>Email: </strong>{{ vehicle.seller.email }}</p>
                    <p><strong>Contact Number: </strong>{{ vehicle.seller.mobile_number }}</p>
                    <p><strong>Click To Check Seller's Other Listings: </strong><a href="listings.html">Click Here</a></p>
          </div>
        </div>
  </div>
<div class="row vehicle-features">
    <div class="col-md-7">
        <h3>Features</h3>
        <div class="feature-list">
            <div class="row">
                <div class="col-sm-6">
                    <ul>
                        <li>
                            {% if vehicle.abs_breaks %}
                                <i class="fas fa-check-circle"></i> ABS Breaks
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.alloy_wheels %}
                                <i class="fas fa-check-circle"></i> Alloy Wheels
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.airbags %}
                                <i class="fas fa-check-circle"></i> Airbags
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.air_conditioning %}
                                <i class="fas fa-check-circle"></i> Air Conditioning
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.power_steering %}
                                <i class="fas fa-check-circle"></i> Power Steering
                            {% endif %}
                        </li>
                    </ul>
                </div>
                <div class="col-sm-6">
                    <ul>
                        <li>
                            {% if vehicle.power_windows %}
                                <i class="fas fa-check-circle"></i> Power Windows
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.central_locking %}
                                <i class="fas fa-check-circle"></i> Central Locking
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.reverse_camera %}
                                <i class="fas fa-check-circle"></i> Reverse Camera
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.sunroof %}
                                <i class="fas fa-check-circle"></i> Sunroof
                            {% endif %}
                        </li>
                        <li>
                            {% if vehicle.leather_seats %}
                                <i class="fas fa-check-circle"></i> Leather Seats
                            {% endif %}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <h3>Description</h3>
        <div class="feature-list">
            <div class="description-text">
                <p>{{ vehicle.description }}</p>
            </div>
        </div>
    </div>

<div class="vehicle-description-card">
    <div class="seller-description-card">

            <p>Bidding Period Ends In,</p>

            <div id="time-remaining-container1"></div>

            <div>
                <h3>Highest Bid: {{ highest_bid }}</h3>
                {% if highest_bid %}
                    <ul>
                        {% for bid in vehicle.bid_set.all %}
                            <li>
                                Amount: {{ bid.amount }} - Status: {{ bid.get_bid_status_display }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No bids yet</p>
                {% endif %}
            </div>
         {% if not auction_ended %}
            <button class="btn btn-primary btn-custom place-bid-button" id="placeBidButtonSeller">Place Bid</button>
        {% endif %}





    </div>
</div>


  </div>
</div>
</div>

{% if not auction_ended %}
<div class="modal fade" id="placeBidModal" tabindex="-1" role="dialog" aria-labelledby="placeBidModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><b>Place Your Bid</b></h4><br>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="vehicle-name"><b>{{ vehicle.model }} {{ vehicle.year }}</b></p>
                <p class="vehicle-price">LKR {{ highest_bid|intcomma }}</p>
                <p class="item-description">Read the item description or contact seller for more information.</p>
                <div class="info-row">
                    <p class="reserve-status">RESERVE NOT YET MET</p>
                    <p class="bids-total">BIDS IN TOTAL FOR VEHICLE: {{ total_bids }}</p>
                </div>

                <p>Bidding Period Ends In,</p>
                <div id="time-remaining-container2"></div>

                    <div class="bid-values">
                        {% for bid_value in bid_increments %}
                            <button class="bid-value" type="button" onclick="setBidValue({{ bid_value }})">LKR {{ bid_value }}</button>
                        {% endfor %}
                    </div>
                <div class="max-bid-section">
                    <p class="max-bid-label">Or Enter Your Maximum Bid:</p>
                    <form method="post" action="{% url 'vehicle_detail' vehicle.id %}" id="bidForm">
                        {% csrf_token %}
                        <div class="max-bid-input">
                            <span class="max-bid-currency">LKR</span>
                            {{ form.amount }}
                        </div>
                        <button class="btn btn-primary btn-block mb-3" id="placeBidModalButton">Place Bid</button>
                    </form>
                    <p class="terms mt-3">
                        By placing a bid, you express consent to share your contact information with the seller and authorize the seller to contact you regarding this vehicle. If this bid wins, you are purchasing this item and legally required to make a payment before THE DATE. The item will be sent once payment is completed.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="countdown-template" style="display: none;">
    <div class="time-remaining">
        <div class="time-unit">
            <span class="time-value" id="days"></span>
            <span class="time-label">DAYS</span>
        </div>
        <span class="time-separator">:</span>
        <div class="time-unit">
            <span class="time-value" id="hours"></span>
            <span class="time-label">HOURS</span>
        </div>
        <span class="time-separator">:</span>
        <div class="time-unit">
            <span class="time-value" id="minutes"></span>
            <span class="time-label">MINUTES</span>
        </div>
        <span class="time-separator">:</span>
        <div class="time-unit">
            <span class="time-value" id="seconds"></span>
            <span class="time-label">SECONDS</span>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
        var bidIncrementButtons = document.querySelectorAll('.bid-value');
        bidIncrementButtons.forEach(button => {
            button.addEventListener('click', function() {
                setBidValue(this.textContent.replace('LKR ', ''));
            });
        });

    var remainingTime = {{ remaining_time|default:'null' }};

    var placeBidButton = document.getElementById('placeBidButton');
    placeBidButton.addEventListener('click', handlePlaceBidClick);

    var placeBidButtonSeller = document.getElementById('placeBidButtonSeller');
    placeBidButtonSeller.addEventListener('click', handlePlaceBidClick);

    var watchlistButton = document.getElementById('watchlistButton');
    watchlistButton.addEventListener('click', handleWatchlistClick);

    var bidForm = document.getElementById('bidForm');
    bidForm.addEventListener('submit', validateBid);

    // Countdown Initialization
    function initializeCountdown(selector, remainingSeconds) {
        var countdownElement = document.querySelector(selector);
        if (!countdownElement) return;

        var daysElem = countdownElement.querySelector('#days');
        var hoursElem = countdownElement.querySelector('#hours');
        var minutesElem = countdownElement.querySelector('#minutes');
        var secondsElem = countdownElement.querySelector('#seconds');

        function updateCountdown() {
            if (remainingSeconds <= 0) {
                countdownElement.innerHTML = "Auction Ended";
                return;
            }

            var days = Math.floor(remainingSeconds / 86400);
            var hours = Math.floor((remainingSeconds % 86400) / 3600);
            var minutes = Math.floor((remainingSeconds % 3600) / 60);
            var seconds = Math.floor(remainingSeconds % 60);

            daysElem.innerText = days;
            hoursElem.innerText = hours;
            minutesElem.innerText = minutes;
            secondsElem.innerText = seconds;

            remainingSeconds--;
            setTimeout(updateCountdown, 1000);
        }

        updateCountdown();
    }

    // Append Countdown Template
    if (remainingTime !== null) {
        var countdownTemplate = document.getElementById('countdown-template').innerHTML;

        function appendCountdown(elementId) {
            var container = document.getElementById(elementId);
            if (container) {
                container.innerHTML += countdownTemplate;
            }
        }

        appendCountdown('time-remaining-container1');
        appendCountdown('time-remaining-container2');

        initializeCountdown('#time-remaining-container1 .time-remaining', remainingTime);
        initializeCountdown('#time-remaining-container2 .time-remaining', remainingTime);
    } else {
        document.getElementById('time-remaining').innerHTML = 'PLACE THE FIRST BID TO START AUCTION';
    }

    // Place Bid Button Event Listener
    if (placeBidButton) {
        placeBidButton.addEventListener('click', handlePlaceBidClick);
    }

    if (placeBidButtonSeller) {
        placeBidButtonSeller.addEventListener('click', function() {
            var isAuthenticated = '{{ user.is_authenticated|yesno:"True,False" }}';

            if (isAuthenticated === 'True') {
                $('#placeBidModal').modal('show');
            } else {
                var loginUrl = '{% url "login" %}?next={{ request.path }}';
                window.location.href = loginUrl;
            }
        });
    }

    // Watchlist Button Event Listener
    if (watchlistButton) {
        watchlistButton.addEventListener('click', handleWatchlistClick);
    }

    // Bid Form Event Listener
    if (bidForm) {
        bidForm.addEventListener('submit', validateBid);
    }

    function handlePlaceBidClick() {
        var isAuthenticated = '{{ user.is_authenticated|yesno:"True,False" }}';

        if (isAuthenticated === 'True') {
            $('#placeBidModal').modal('show');
        } else {
            var loginUrl = '{% url "login" %}?next={{ request.path }}';
            window.location.href = loginUrl;
        }
    }

    function handleWatchlistClick() {
        var isAuthenticated = '{{ user.is_authenticated|yesno:"True,False" }}';
        var vehicleId = this.dataset.vehicleId;

        if (isAuthenticated === 'True') {
            fetch(`{% url 'toggle_watchlist' 0 %}`.replace('0', vehicleId), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ vehicle_id: vehicleId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.added) {
                    this.innerHTML = '<i class="fas fa-check"></i> Added to Watchlist';
                    this.classList.remove('btn-outline-secondary');
                    this.classList.add('btn-success');
                } else {
                    this.innerHTML = '<i class="far fa-star"></i> Add to Watchlist';
                    this.classList.remove('btn-success');
                    this.classList.add('btn-outline-secondary');
                }
            });
        } else {
            var loginUrl = '{% url "login" %}?next={{ request.path }}';
            window.location.href = loginUrl;
        }
    }

    function setBidValue(value) {
        var bidInput = document.getElementById('id_amount');
        if (bidInput) {
            bidInput.value = value;
        }
    }

    function validateBid(event) {
        var highestBid = {{ highest_bid }};
        var bidInput = document.getElementById('id_amount');
        var bidValue = parseFloat(bidInput.value.replace(/,/g, ''));

        if (bidValue <= highestBid) {
            alert('Please enter a bid higher than the current highest bid.');
            event.preventDefault();
        }
    }
});

function displayImage(imageUrl) {
    document.getElementById('main-image').src = imageUrl;
}

</script>


{% endblock %}